part of 'target_operator.dart';

class _CodeQualityReport {
  static const _ignoredFiles =
      "**/*.freezed.dart,**/*g.dart,lib/config/**,assets/images/**,.firebase/**";

  static ProcessResult generateTestCoverageReport() =>
      Process.runSync('genhtml', ['coverage/lcov.info', '-o', 'coverage/html']);

  static void duplicateCodeReport(
    List<String> sourceDir,
    String reportName,
  ) {
    Process.runSync('jscpd', [
      ...sourceDir,
      '--reporters',
      'html',
      '--ignore',
      _ignoredFiles,
      '--output',
      reportName,
      '--min-lines',
      '10',
    ]);
  }

  static void removeCodeFromCoverage({List<String>? unchangedFiles}) {
    log('Removing autogenerated files for test coverage...');

    var args = [
      '-f',
      'coverage/lcov.info',
      '-r',
      r'\.g\.dart$',
    ];

    if (unchangedFiles != null && unchangedFiles.isNotEmpty) {
      args = args.map((file) => '-r $file').toList();
    }

    Process.runSync(
      'remove_from_coverage',
      args,
    );
  }
}
